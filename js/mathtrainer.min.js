!function(){"use strict";var operators={add:{name:"add",sign:"+",result:function(a,b){return a+b}},sub:{name:"sub",sign:"-",result:function(a,b){return a-b}},mul:{name:"mul",sign:"×",result:function(a,b){return a*b}},div:{name:"div",sign:"÷",result:function(a,b){return a/b}}},config={min:0,max:0,minutes:0,avoidNegatives:!0,operators:["add","div"]},stats={total:0,skipped:0},question={a:0,b:0,result:0},trainer={},randomInt,getRandomOperator,updateQuestionText,createNew,skip,verifyAndContinue,error,errorAdded,add,hasErrors,reset,registerMinAndMaxValues,initializeMinAndMax,initializeMinutes,initializeOperators,initializeAvoidNegatives,initialize,setScoreText,showScore,timer,computeElapsedTime,start,initializeTrainer;trainer.question=(randomInt=function(min,max){return Math.floor(Math.random()*(max-min+1))+min},getRandomOperator=function(){return operators[config.operators[randomInt(0,config.operators.length-1)]]},updateQuestionText=function(sign){$("#answer").val(""),$("#currentquestion").text(question.a+" "+sign+" "+question.b),$("#progress").text(i18n.t("messages.score",{total:stats.total,skipped:stats.skipped}))},skip=function(){++stats.skipped,createNew()},verifyAndContinue=function(){var userResult=parseInt($("#answer").val());isNaN(userResult)||userResult!==question.result||(++stats.total,createNew())},{createNew:createNew=function(){var a=randomInt(config.min,config.max),b=randomInt(config.min,config.max),operator=getRandomOperator();if("sub"===operator.name&&config.avoidNegatives){var ab=a>b?[b,a]:[a,b];a=ab[1],b=ab[0],question.result=a-b}else if("div"===operator.name){var mulResult=a*b;question.result=a,a=mulResult}else question.result=operator.result(a,b);question.a=a,question.b=b,updateQuestionText(operator.sign)},skip:skip,verifyAndContinue:verifyAndContinue}),trainer.options=(errorAdded=!1,error={add:function(ids,message){errorAdded=!0;var errorDiv=$('<div class="errormessage"><span class="glyphicon glyphicon-warning-sign"></span> </div>');errorDiv.append(message),$("#options_error").append(errorDiv),$.each(ids,(function(key,value){$("#"+value).closest(".form-group").addClass("has-error")}))},hasErrors:function(){return errorAdded},reset:function(){$("#options_error").text(""),$(".has-error").removeClass("has-error"),errorAdded=!1}},registerMinAndMaxValues=function(min,max){if(min>max){var tmp=max;max=min,min=tmp,$("#rangemin").val(min),$("#rangemax").val(max)}config.min=min,config.max=max},initializeMinAndMax=function(){var min=parseInt($("#rangemin").val()),max=parseInt($("#rangemax").val()),hasErrors=!1;(isNaN(min)||min<-9999999||min>9999999)&&(error.add(["rangemin"],i18n.t("errors.rangeMinInvalid",{min:-9999999,max:9999999})),hasErrors=!0),(isNaN(max)||max<-9999999||max>9999999)&&(error.add(["rangemax"],i18n.t("errors.rangeMaxInvalid",{min:-9999999,max:9999999})),hasErrors=!0),!hasErrors&&min>=max&&(error.add(["rangemin","rangemax"],i18n.t("errors.rangeIntervalInvalid")),hasErrors=!0),hasErrors||registerMinAndMaxValues(min,max)},initializeMinutes=function(){var timerValue=parseInt($("#timerlength").val());isNaN(timerValue)||timerValue<=0||timerValue>60?error.add(["timerlength"],i18n.t("errors.minutesInvalid",{min:1,max:60})):config.minutes=timerValue},initializeOperators=function(){var inputOperators=[];for(var key in operators)operators.hasOwnProperty(key)&&$("#op"+key).is(":checked")&&inputOperators.push(key);0===inputOperators.length?error.add(["operators"],i18n.t("errors.noOperators")):config.operators=inputOperators},initializeAvoidNegatives=function(){config.min>=0?config.avoidNegatives=$("#avoidnegatives").is(":checked"):config.avoidNegatives=!1},{initialize:function(){return error.reset(),initializeMinutes(),initializeMinAndMax(),initializeOperators(),error.hasErrors()?($("#optionserrors").show(),!1):($("#optionserrors").hide(),initializeAvoidNegatives(),!0)}}),trainer.run=(setScoreText=function(timeString){var seconds=1;if(timeString)seconds=60*parseInt(timeString.split(":")[0])+parseInt(timeString.split(":")[1]);else{timeString=config.minutes+" "+(1!==config.minutes?i18n.t("labels.minutes"):i18n.t("labels.minute")),seconds=parseInt(60*config.minutes);var rate=(parseInt(stats.total)/parseInt(seconds)).toFixed(3);writeScore(rate)}$("#finalScore").text(i18n.t("messages.finalScore",{scoreTime:timeString,scoreTotal:stats.total,scoreSkipped:stats.skipped,rate:rate}))},showScore=function(timeString){setScoreText(timeString),$("#useranswer").fadeOut(50,(function(){$("#questions").fadeOut((function(){$("#score, #options").fadeIn()}))}))},computeElapsedTime=function(event){if(0===event.offset.seconds)return config.minutes-event.offset.minutes+":00";var remainingSeconds=60-event.offset.seconds;return config.minutes-event.offset.minutes-1+":"+(remainingSeconds<10?"0":"")+remainingSeconds},timer={start:function(){$("#timer").countdown((new Date).getTime()+6e4*config.minutes).on("update.countdown",(function(event){$(this).text(event.strftime("%M:%S"))})).on("stoped.countdown",(function(event){showScore(computeElapsedTime(event))})).on("finish.countdown",(function(){showScore()}))}},{initializeTrainer:function(){stats.total=0,stats.skipped=0,$("#options").fadeOut((function(){$("#questions, #useranswer").fadeIn((function(){$("#answer").focus()}))})),$("#score").fadeOut(),timer.start()}}),$(document).ready((function(){i18n.init((function(err,t){$(".i18n").i18n(),document.title=t("labels.appName")})),$("input[type=number]").change((function(e){var value=parseInt($(this).val());$(this).val(isNaN(value)?$(this).prop("defaultValue"):value)})),$("#answer").keyup((function(e){32===e.which?trainer.question.skip():27===e.which?$(this).val(""):trainer.question.verifyAndContinue()})),$("form#options").submit((function(e){var hasValidOptions;e.preventDefault(),trainer.options.initialize()&&(trainer.question.createNew(),trainer.run.initializeTrainer())})),$("#skipquestion").click((function(){trainer.question.skip(),$("#answer").focus()})),$("#clearquestion").click((function(){$("#answer").val(""),$("#answer").focus()})),$("#quittooptions").click((function(){$("#timer").countdown("stop")})),$("#start").fadeIn()}))}();